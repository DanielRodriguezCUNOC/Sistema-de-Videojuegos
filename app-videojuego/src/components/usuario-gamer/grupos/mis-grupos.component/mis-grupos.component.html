<div class="dashboard">
  <div class="topbar">
    <button class="back-btn" (click)="regresar()">
      <i class="fas fa-arrow-left"></i>
      Regresar
    </button>
    <h1 class="page-title">Mis Grupos</h1>
    <button class="create-btn" (click)="crearGrupo()">
      <i class="fas fa-plus"></i>
      Crear Grupo
    </button>
  </div>

  <div class="content">
    <div class="table-container">
      <div class="table-header">
        <h2>
          <i class="fas fa-check-circle"></i>
          Grupos Activos
        </h2>
        <span class="total-count">Total: {{ gruposActivos.length || 0 }}</span>
      </div>

      @if(gruposActivos && gruposActivos.length > 0) {
      <div class="table-wrapper">
        <table class="groups-table">
          <thead>
            <tr>
              <th>ID Grupo</th>
              <th>Nombre</th>
              <th>Miembros</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for(grupo of gruposActivos; track grupo.idGrupo) {
            <tr class="table-row">
              <td class="id-cell">{{ grupo.idGrupo }}</td>
              <td class="name-cell">{{ grupo.nombreGrupo }}</td>
              <td class="members-cell">{{ grupo.integrantes.length || 0 }}</td>
              <td class="actions-cell">
                <button
                  class="action-btn edit-btn"
                  (click)="editarGrupo(grupo.idGrupo, grupo.nombreGrupo)"
                  title="Editar nombre del grupo"
                >
                  <i class="fas fa-edit"></i>
                  Editar
                </button>
                <button
                  class="action-btn deactivate-btn"
                  (click)="desactivarGrupo(grupo.idGrupo)"
                  title="Desactivar grupo"
                >
                  <i class="fas fa-pause-circle"></i>
                  Desactivar
                </button>
                <button
                  class="action-btn edit-btn"
                  (click)="agregarIntegrante(grupo.idGrupo)"
                  title="Agregar integrante al grupo"
                >
                  Agregar Integrante
                </button>
                @for(integrante of grupo.integrantes; track integrante.idIntegrante) {
                @if(integrante.idIntegrante ) {
                <button
                  class="action-btn remove-member-btn"
                  (click)="eliminarIntegrante(grupo.idGrupo, integrante.idIntegrante)"
                  title="Eliminar integrante: {{ integrante.nickname }}"
                >
                  <i class="fas fa-user-minus"></i>
                  Eliminar {{ integrante.nickname }}
                </button>
                } }
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      }@else{
      <div class="no-data">
        <i class="fas fa-users-slash"></i>
        <h3>No tienes grupos activos</h3>
        <p>Activa algún grupo existente o crea uno nuevo</p>
      </div>
      }
    </div>

    <div class="table-container inactive-section">
      <div class="table-header">
        <h2>
          <i class="fas fa-pause-circle"></i>
          Grupos Inactivos
        </h2>
        <span class="total-count">Total: {{ gruposInactivos.length || 0 }}</span>
      </div>

      @if(gruposInactivos && gruposInactivos.length > 0) {
      <div class="table-wrapper">
        <table class="groups-table">
          <thead>
            <tr>
              <th>ID Grupo</th>
              <th>Nombre</th>
              <th>Miembros</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for(grupo of gruposInactivos; track grupo.idGrupo) {
            <tr class="table-row inactive-row">
              <td class="id-cell">{{ grupo.idGrupo }}</td>
              <td class="name-cell">{{ grupo.nombreGrupo }}</td>
              <td class="members-cell">{{ grupo.integrantes.length || 0 }}</td>
              <td class="actions-cell">
                <button
                  class="action-btn activate-btn"
                  (click)="activarGrupo(grupo.idGrupo)"
                  title="Activar grupo"
                >
                  <i class="fas fa-play-circle"></i>
                  Activar
                </button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      }@else{
      <div class="no-data">
        <i class="fas fa-check-circle"></i>
        <h3>Todos tus grupos están activos</h3>
        <p>No tienes grupos desactivados</p>
      </div>
      }
    </div>

    @if(!grupos || grupos.length === 0) {
    <div class="table-container">
      <div class="no-data">
        <i class="fas fa-users"></i>
        <h3>No tienes grupos creados</h3>
        <p>Comienza creando tu primer grupo para jugar con amigos</p>
        <button class="create-btn" (click)="crearGrupo()">
          <i class="fas fa-plus"></i>
          Crear Primer Grupo
        </button>
      </div>
    </div>
    }
  </div>
</div>

<app-share-popup
  [mensaje]="infoMessage || ''"
  [tipo]="popupTipo"
  [mostrar]="popupMostrar"
  (cerrarEvent)="popupMostrar = false"
></app-share-popup>
