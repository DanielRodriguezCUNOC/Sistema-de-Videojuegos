<div class="dashboard">
  <div class="topbar">
    <button class="back-btn" (click)="regresar()">
      <i class="fas fa-arrow-left"></i>
      Regresar
    </button>
    <h1 class="page-title">Gestión de Comentarios</h1>
    <button
      class="load-btn"
      (click)="cargarDatosComentarios()"
      [disabled]="isLoading"
      title="Cargar datos desde el servidor"
    >
      <i class="fas fa-refresh" [class.fa-spin]="isLoading"></i>
      {{ isLoading ? 'Cargando...' : 'Cargar Datos' }}
    </button>
  </div>

  <div class="content">
    @if(isLoading) {
    <div class="loading-container">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Cargando datos de comentarios...</p>
    </div>
    } @else if(videojuegos.length === 0 && estadoComentarioGeneral.idEmpresa === 0) {
    <div class="initial-state">
      <i class="fas fa-database"></i>
      <h3>Datos no cargados</h3>
      <p>Presiona el botón "Cargar Datos" para obtener la información de comentarios</p>
    </div>
    } @else {

    <div class="general-settings">
      <div class="settings-header">
        <h2>Estado General de Comentarios</h2>
        <p>Configura el estado global de los comentarios para todos los videojuegos</p>
      </div>

      <div class="toggle-container">
        <label class="toggle-switch">
          <span class="toggle-label">Comentarios Generales:</span>
          <input
            type="checkbox"
            [(ngModel)]="estadoComentarioGeneral.estadoComentarioGeneral"
            (change)="cambiarEstadoGeneral($event)"
            [disabled]="isLoading"
          />
          <span class="slider"></span>
          <span
            class="status-text"
            [class.enabled]="estadoComentarioGeneral.estadoComentarioGeneral"
            [class.disabled]="!estadoComentarioGeneral.estadoComentarioGeneral"
          >
            {{ estadoComentarioGeneral.estadoComentarioGeneral ? 'Habilitados' : 'Deshabilitados' }}
          </span>
        </label>
      </div>
    </div>

    <div class="table-container">
      <div class="table-header">
        <h2>Estado por Videojuego</h2>
        <span class="total-count">Total: {{ videojuegos.length || 0 }}</span>
      </div>

      @if(videojuegos && videojuegos.length > 0) {

      <div class="table-wrapper">
        <table class="comments-table">
          <thead>
            <tr>
              <th>ID Videojuego</th>
              <th>Título</th>
              <th>Estado General</th>
              <th>Estado Videojuego</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for(videojuego of videojuegos; track videojuego.idVideojuego) {
            <tr class="table-row">
              <td class="id-cell">{{ videojuego.idVideojuego }}</td>
              <td class="title-cell">{{ videojuego.titulo }}</td>
              <td class="status-cell">
                <span
                  class="status-badge"
                  [class.status-enabled]="videojuego.estadoComentarioVideojuego"
                  [class.status-disabled]="!videojuego.estadoComentarioVideojuego"
                >
                  {{ videojuego.estadoComentarioVideojuego ? 'Habilitado' : 'Deshabilitado' }}
                </span>
              </td>
              <td class="videogame-status-cell">
                <span
                  class="videogame-badge"
                  [class.videogame-enabled]="videojuego.estadoComentarioVideojuego"
                  [class.videogame-disabled]="!videojuego.estadoComentarioVideojuego"
                >
                  {{ videojuego.estadoComentarioVideojuego ? 'Habilitado' : 'Deshabilitado' }}
                </span>
              </td>
              <td class="actions-cell">
                <button
                  class="action-btn toggle-btn"
                  [class.enable-btn]="!videojuego.estadoComentarioVideojuego"
                  [class.disable-btn]="videojuego.estadoComentarioVideojuego"
                  [disabled]="isLoading"
                  (click)="
                    cambiarEstadoVideojuego(
                      videojuego.idVideojuego,
                      videojuego.estadoComentarioVideojuego
                    )
                  "
                  [title]="
                    videojuego.estadoComentarioVideojuego
                      ? 'Deshabilitar comentarios'
                      : 'Habilitar comentarios'
                  "
                >
                  <i
                    class="fas"
                    [class.fa-toggle-off]="!videojuego.estadoComentarioVideojuego"
                    [class.fa-toggle-on]="videojuego.estadoComentarioVideojuego"
                  ></i>
                  {{ videojuego.estadoComentarioVideojuego ? 'Deshabilitar' : 'Habilitar' }}
                </button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      }@else{
      <div class="no-data">
        <i class="fas fa-comments"></i>
        <h3>No hay videojuegos registrados</h3>
        <p>Añade videojuegos para gestionar sus comentarios</p>
      </div>
      }
    </div>

    }
  </div>
</div>

<app-share-popup
  [mensaje]="infoMessage || ''"
  [tipo]="popupTipo"
  [mostrar]="popupMostrar"
  (cerrarEvent)="popupMostrar = false"
></app-share-popup>
